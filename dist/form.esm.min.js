class ControlBase{static template='<div class="form-item"><div class="form-item-main"><div class="field-infor"><div class="field-title"><span></span></div><div class="field-describe"><i></i></div></div></div><div class="invalid-msgbox"><span class="danger"></span></div></div>';static fragment=null;constructor(){ControlBase.fragment||(ControlBase.fragment=document.createRange().createContextualFragment(ControlBase.template))}get title(){return this.element.title.textContent}set title(e){return this.element.title.textContent=e,e}get describe(){return this.element.describe.textContent}set describe(e){return this.element.describe.textContent=e,e}get danger(){return this.element.danger.textContent}set danger(e){return this.element.danger.textContent=e,e}get valid(){return this.element.field.validity.valid}get value(){throw new Error('"value" must be implemented by subclass')}set value(e){throw new Error('"value" must be implemented by subclass')}get required(){return this.element.field.hasAttribute("required")}set required(e){return e?(this.element.field.setAttribute("required",""),this.element.head.classList.add("required"),!0):(this.element.field.removeAttribute("required"),this.element.head.classList.remove("required"),!1)}get disabled(){return this.element.field.hasAttribute("disabled")}set disabled(e){return e?(this.element.field.setAttribute("disabled",""),!0):(this.element.field.removeAttribute("disabled"),!1)}init(e){if(this.prompt.pattern="\u8f93\u5165\u4e0d\u6b63\u786e",this.element.head=null,this.element.title=null,this.element.field=null,this.element.danger=null,this.element.describe=null,Object.hasOwn(e,"message")){const t=e.message;for(const e of Object.keys(t))this.prompt[e]=t[e]}}event(){throw new Error('"event" method must be implemented by subclass')}build(){throw new Error('"build" method must be implemented by subclass')}bind(){throw new Error('"bind" method must be implemented by subclass')}create(e,t){this.type=t.type,this.name=t.name;const n=ControlBase.fragment.firstElementChild.cloneNode(!0);n.querySelector(".form-item-main").append(e),this.element.head=n.querySelector(".field-title"),this.element.title=this.element.head.firstElementChild,this.element.describe=n.querySelector("i"),this.element.danger=n.querySelector(".danger"),t.label&&(this.element.title.textContent=t.label),t.required&&this.element.head.classList.add("required"),t.describe&&(this.element.describe.textContent=t.describe),this.root=n}render(e){this.init(e),this.create(e),this.build(e),this.hook(e),this.bind()}clear(){this.element.danger.textContent&&(this.element.danger.textContent="")}change(){this.root.classList.remove("invalid"),this.clear()}invalid(){throw new Error('"invalid" method must be implemented by subclass')}validity(){throw new Error('"validity" method must be implemented by subclass')}message(e){this.element.danger.textContent=e}reset(){this.root.classList.remove("invalid"),this.clear()}focus(){this.root.scrollIntoView({behavior:"smooth",block:"start"})}unload(){for(const e of Object.keys(this.element))this.element[e].remove(),this.element[e]=null;this.root.remove(),this.element=null,this.messge=null,this.root=null}check(e){if(void 0===e||null==e)throw new Error("Required parameter missing");if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Parameter type error");const t=["type","name"],n=["required","readonly","disabled"],o=["label","describe"];for(const n of t){if(!Object.hasOwn(e,n))throw new Error(`The "${n}" attribute is a required attribute.`);if("string"!=typeof e[n])throw new Error(`The "${n}" attribute must be of string type.`);if(e[n]=e[n].trim(),0===e[n].length)throw new Error(`The "${n}" attribute is a required attribute.`)}for(const t of n)if(Object.hasOwn(e,t)&&"boolean"!=typeof e[t])throw new Error(`The "${t}" attribute must be of boolean type.`);for(const t of o)if(Object.hasOwn(e,t)&&"string"!=typeof e[t])throw new Error(`The "${t}" attribute must be of string type.`);if(Object.hasOwn(e,"message")){if("[object Object]"!==Object.prototype.toString.call(e.message))throw new Error('The "message" attribute must be of object type.');for(const t of Object.keys(e.message))if("string"!=typeof e.message[t])throw new Error(`The "message.${t}" attribute must be of string type.`)}return!0}}class InputControlBase extends ControlBase{constructor(){super()}get value(){return this.element.field.value}set value(e){return this.element.field.value=e,e}get readonly(){return this.element.field.hasAttribute("readonly")}set readonly(e){return e?(this.element.field.setAttribute("readonly",""),!0):(this.element.field.removeAttribute("readonly"),!1)}init(e){this.prompt.required="\u6b64\u9879\u4e3a\u5fc5\u586b\u9879",super.init(e)}build(e){const t=this.element.field;if(e.name&&t.setAttribute("name",e.name),e.required&&(t.setAttribute("required",""),t.setAttribute("minlength","1")),e.readonly&&t.setAttribute("readonly",""),e.disabled&&t.setAttribute("disabled",""),e.props){const n=e.props;for(let e of Object.keys(n))t.setAttribute(e,n[e])}}bind(){const e=this.element.field;return e.addEventListener("blur",function(){this.classList.add("first")},{once:!0}),e.onchange=()=>{this.change()},e.oninput=()=>{this.change()},e.onblur=()=>{this.validity()},e.oninvalid=e=>{e.preventDefault(),this.invalid()},!0}validity(){const e=this.element.field,t=e.validity;if(t.valid)this.root.classList.remove("invalid"),this.clear();else if(this.root.classList.add("invalid"),t.valueMissing)this.message(this.prompt.required);else if(t.patternMismatch)this.message(this.prompt.pattern);else if(t.typeMismatch)this.message("\u683c\u5f0f\u9519\u8bef");else if(t.rangeOverflow){const t=parseFloat(e.step)||1,n=parseFloat(e.min)||0,o=(parseFloat(e.max)-n)/t,r=Math.floor(o);o-r<1?this.message(`\u503c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e${t*r+n}`):this.message(`\u503c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e${e.max}`)}else if(t.rangeUnderflow)this.message(`\u503c\u5fc5\u987b\u5927\u4e8e\u6216\u7b49\u4e8e${e.min}`);else if(t.stepMismatch){const t=parseFloat(e.step)||1;if(1==t)this.message("\u5fc5\u987b\u8f93\u5165\u6574\u6570");else{const n=parseFloat(e.min)||0,o=(parseFloat(e.value)-n)/t,r=Math.floor(o);o-r<1&&this.message(`\u503c\u65e0\u6548\uff0c\u4e0b\u4e00\u4e2a\u6b63\u786e\u503c\u4e3a${t*(r+1)+n}`)}}else t.badInput?this.message("\u8f93\u5165\u9519\u8bef"):t.tooLong?this.message(this.prompt.maxlength||`\u6700\u591a\u8f93\u5165${e.getAttribute("maxlength")}\u4e2a\u5b57\u7b26`):t.tooShort?this.message(this.prompt.minlength||`\u81f3\u5c11\u8f93\u5165${e.getAttribute("minlength")}\u4e2a\u5b57\u7b26`):this.message(e.validationMessage)}change(){this.element.field.classList.add("first"),super.change()}invalid(){this.element.field.classList.add("first"),this.validity()}reset(){this.element.field.classList.remove("first"),super.reset()}focus(){super.focus(),this.element.field.focus()}check(e){if(super.check(e)){if(Object.hasOwn(e,"props")){if("[object Object]"!==Object.prototype.toString.call(e.props))throw new Error('The "props" attribute must be of object type.');const t=e.props,n=["min","max","minlength","maxlength","step","rows","cols"];for(const e of Object.keys(t))if(n.includes(e)){if("number"!=typeof t[e])throw new Error(`The "props.${e}" attribute must be of number type.`)}else if("string"!=typeof t[e])throw new Error(`The "props.${e}" attribute must be of string type.`)}return!0}return!1}}class SelectControlBase extends ControlBase{constructor(){super()}init(e){this.prompt.required="\u6b64\u9879\u4e3a\u5fc5\u9009\u9879",super.init(e)}build(e){const t=this.element.field;e.name&&t.setAttribute("name",e.name),e.required&&t.setAttribute("required",""),e.disabled&&t.setAttribute("disabled","")}bind(){const e=this.element.field;return e.onchange=()=>{this.change()},e.onblur=e=>{this.blur(e.target)},e.oninvalid=e=>{e.preventDefault(),this.invalid(e.target)},!0}validity(e){const t=e.validity;t.valid?(this.root.classList.remove("invalid"),this.clear()):(this.root.classList.add("invalid"),t.valueMissing?this.message(this.prompt.required):t.patternMismatch?this.message(this.prompt.pattern):this.message(e.validationMessage))}check(e){if(super.check(e)){if(Object.hasOwn(e,"options")){if("[object Array]"!==Object.prototype.toString.call(e.options))throw new Error('The "options" attribute must be of array type.');const t=e.options;for(const e of t){if(!Object.hasOwn(e,"value"))throw new Error('The "options.value" attribute is a required attribute.');if("string"!=typeof e.value&&"number"!=typeof e.value)throw new Error('The "options.value" attribute must be of string or numeric type.');if("string"==typeof e.value&&!Boolean(e.value))throw new Error('The "options.value" attribute is a required attribute.');if(Object.hasOwn(e,"title")&&"string"!=typeof e.title)throw new Error('The "options.title" attribute must be of string type.');Object.hasOwn(e,"title")||(e.title=e.value)}}return!0}return!1}}class TextControl extends InputControlBase{static template='<div class="field-input"><label><input type="text" value="" placeholder="\u8bf7\u8f93\u5165"/></label></div>';static fragment=null;root=null;type="text";name="Text";element=Object.create(null);prompt=Object.create(null);constructor(e){super(),TextControl.fragment||(TextControl.fragment=document.createRange().createContextualFragment(TextControl.template)),this.check(e)&&this.render(e)}create(e){super.create(TextControl.fragment.firstElementChild.cloneNode(!0),e),this.element.field=this.root.querySelector("input")}hook(e){const t=this.element.field;switch(t.setAttribute("type",e.type),e.value&&t.setAttribute("value",e.value),e.type){case"text":t.setAttribute("title","\u8bf7\u8f93\u5165\u6587\u5b57");break;case"number":t.setAttribute("title","\u8bf7\u8f93\u5165\u6570\u5b57");break;case"search":t.setAttribute("title","\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9");break;case"password":t.setAttribute("title","\u8bf7\u8f93\u5165\u5bc6\u7801");break;case"tel":t.setAttribute("title","\u8bf7\u8f93\u5165\u7535\u8bdd\u53f7\u7801");break;case"url":t.setAttribute("title","\u8bf7\u8f93\u5165\u7f51\u5740");break;case"email":t.setAttribute("title","\u8bf7\u8f93\u5165\u7535\u5b50\u90ae\u7bb1");break;case"date":t.setAttribute("title","\u8bf7\u9009\u62e9\u65e5\u671f");break;case"month":t.setAttribute("title","\u8bf7\u9009\u62e9\u5e74\u6708");break;case"time":t.setAttribute("title","\u8bf7\u9009\u62e9\u65f6\u95f4");break;case"datetime":case"datetime-local":t.setAttribute("title","\u8bf7\u9009\u62e9\u65e5\u671f\u548c\u65f6\u95f4");break;case"color":t.setAttribute("title","\u8bf7\u70b9\u51fb\u83b7\u53d6\u989c\u8272");break;case"range":t.setAttribute("title","\u8bf7\u62d6\u52a8\u83b7\u53d6\u6570\u503c")}return!0}}class TextareaControl extends InputControlBase{static template='<div class="field-input"><label><textarea rows="8" placeholder="\u8bf7\u8f93\u5165" title="\u8bf7\u8f93\u5165\u6587\u5b57\u5185\u5bb9"></textarea></label></div>';static fragment=null;root=null;type="textarea";name="Textarea";element=Object.create(null);prompt=Object.create(null);constructor(e){super(),TextareaControl.fragment||(TextareaControl.fragment=document.createRange().createContextualFragment(TextareaControl.template)),this.check(e)&&this.render(e)}create(e){super.create(TextareaControl.fragment.firstElementChild.cloneNode(!0),e),this.element.field=this.root.querySelector("textarea")}hook(e){const t=this.element.field;return e.value&&(t.textContent=e.value),e.title&&t.setAttribute("title",e.title),!0}}class SelectControl extends SelectControlBase{static template='<div class="field-select"><label><select title="\u8bf7\u9009\u62e9"><option value="" hidden>\u8bf7\u9009\u62e9</option></select></label></div>';static fragment=null;root=null;type="select";name="Select";element=Object.create(null);prompt=Object.create(null);constructor(e){super(),SelectControl.fragment||(SelectControl.fragment=document.createRange().createContextualFragment(SelectControl.template)),this.check(e)&&this.render(e)}get value(){return this.element.field.value}set value(e){const t=this.element.field.options;for(let n=0;n<t.length;n++)t[n].value!==e&&t[n].textContent!==e||(this.element.field.value=t[n].value)}create(e){super.create(SelectControl.fragment.firstElementChild.cloneNode(!0),e),this.element.field=this.root.querySelector("select")}bind(){const e=this.element.field;return e.addEventListener("blur",function(){this.classList.add("selected")},{once:!0}),e.onchange=()=>{this.change()},e.onblur=e=>{this.invalid(e.target)},e.oninvalid=e=>{e.preventDefault(),this.invalid(e.target)},!0}hook(e){if(Object.hasOwn(e,"options")&&Array.isArray(e.options)){const t=e.options;for(let n=0;n<t.length;n++){const o=document.createElement("option");t[n].value&&o.setAttribute("value",t[n].value),t[n].title&&(o.textContent=t[n].title),e.value&&(t[n].value!==e.value&&t[n].title!==e.value||o.setAttribute("selected","")),this.element.field.append(o)}}return!0}change(){this.element.field.classList.add("selected"),super.change()}invalid(e){this.element.field.classList.add("selected"),this.validity(e)}reset(){this.element.field.classList.remove("selected"),super.reset()}focus(){super.focus(),this.element.field.focus()}}class RadioControl extends SelectControlBase{static template='<div class="field-input"><div class="input-radio"></div></div>';static fragment=null;root=null;type="radio";name="Radio";element=Object.create(null);prompt=Object.create(null);constructor(e){super(),RadioControl.fragment||(RadioControl.fragment=document.createRange().createContextualFragment(RadioControl.template)),this.check(e)&&this.render(e)}get valid(){return!(this.element.field.length>0)||this.element.field[0].validity.valid}get value(){for(const e of this.element.field)if(e.checked)return e.getAttribute("value");return""}set value(e){for(const t of this.element.field)if(t.hasAttribute("value")&&t.getAttribute("value")===e)return t.checked=!0,!0;return!1}create(e){super.create(RadioControl.fragment.firstElementChild.cloneNode(!0),e),this.element.option=this.root.querySelector(".input-radio"),this.element.options=[],this.element.field=[]}build(){return!0}bind(){for(const e of this.element.field)e.addEventListener("blur",function(){this.classList.add("first")},{once:!0}),e.onchange=()=>{this.change()},e.oninvalid=e=>{e.preventDefault(),this.validity(e.target)}}hook(e){if(e.options&&Array.isArray(e.options)){const t=e.options;for(let n=0;n<t.length;n++){const o=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","radio"),e.required&&r.setAttribute("required",""),e.name&&r.setAttribute("name",e.name),t[n].value&&r.setAttribute("value",t[n].value);const i=document.createElement("span");t[n].title&&(i.textContent=t[n].title),e.value&&(t[n].value!==e.value&&t[n].title!==e.value||r.setAttribute("checked","")),o.append(r),o.append(i),this.element.options.push(r),this.element.option.append(o),this.element.field.push(r)}}return!0}focus(){this.element.field.length>0&&this.element.field[0].focus()}}class CheckControl extends SelectControlBase{static template='<div class="field-input"><div class="input-checkbox" title="\u53ef\u591a\u9009"></div><label class="input-hidden"><input type="text" data-type="check" value="" autocomplete="off" placeholder="\u8bf7\u8f93\u5165"></label></div>';static fragment=null;root=null;type="checkbox";name="Checkbox";element=Object.create(null);prompt=Object.create(null);constructor(e){super(),CheckControl.fragment||(CheckControl.fragment=document.createRange().createContextualFragment(CheckControl.template)),this.check(e)&&this.render(e)}get value(){const e=[];for(const t of this.element.options)t.checked&&e.push(t.value);return e}set value(e){for(const t of this.element.options)if(t.hasAttribute("value")&&t.getAttribute("value")===e)return t.checked=!0,!0;return!1}create(e){super.create(CheckControl.fragment.firstElementChild.cloneNode(!0),e),this.element.option=this.root.querySelector(".input-checkbox"),this.element.field=this.root.querySelector("input"),this.element.options=[]}bind(){const e=this.element.field;e.oninput=()=>{this.change()},e.oninvalid=e=>{e.preventDefault(),this.invalid(e.target)};const t=this.element.options;for(const e of t)e.onchange=()=>{this.change(),this.checked()},e.onblur=()=>{this.blur()};return!0}hook(e){if(this.root.querySelector(".form-item-main").classList.add("top"),e.options&&Array.isArray(e.options)){const t=e.options;for(let n=0;n<t.length;n++){const o=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","checkbox"),e.name&&r.setAttribute("data-name",e.name);const i=document.createElement("span");if(t[n].value&&r.setAttribute("value",t[n].value),t[n].title?i.textContent=t[n].title:t[n].value&&(i.textContent=t[n].value),e.value)if(Array.isArray(e.value))for(let o=0;o<e.value.length;o++)t[n].value!==e.value[o]&&t[n].title!==e.value[o]||r.setAttribute("checked","");else t[n].value!==e.value&&t[n].title!==e.value||r.setAttribute("checked","");o.append(r),o.append(i),this.element.options.push(r),this.element.option.append(o)}}return!0}checked(){const e=this.value;this.element.field.value=e.toString()}blur(){this.validity(this.element.field)}invalid(e){this.element.field.classList.add("first"),this.validity(e)}}export default class FormControl extends HTMLElement{#e=null;#t=null;#n=null;#o=Object.create(null);#r=Object.create(null);#i=Object.create(null);#s=new Map;#l=new Map;constructor(){super(),this.#a(),this.#e=this.attachShadow({mode:"closed"});const e=new CSSStyleSheet;e.replaceSync(':host{contain:content;font-size:inherit;--form-legend-backg-color:rgb(0,108,190);--form-item-row-gap:0.35em;--form-item-border-style:none;--form-item-focus-bgcolor:rgba(244,245,255,0.90);--form-item-invalid-bgcolor:rgb(252,236,236);--form-field-title-width:4em;--form-field-title-weight:bold;--form-input-width:100%;--form-input-radio-width:15%;--form-input-check-width:25%;--form-input-border-radius:0.22em;--form-input-accent-color:rgb(0,0,255);--form-input-focus-color:rgb(110,168,246);--form-option-bgcolor:rgb(24,145,242);--form-button-width:100%;--form-button-border-radius:0.2em;--form-button-backg-color:rgb(24,145,242);--form-button-bgcolor-hover:rgb(0,107,189);--form-button-bgcolor-active:rgb(0,92,163)}form{background-color:#fff}a,button,datalist,div,fieldset,form,i,img,input,label,legend,option,p,select,span,svg,textarea{box-sizing:border-box}.form-group{margin:0;padding:.5em 0;border:0}.form-group>legend{padding-inline:1em;width:100%;font-weight:700;line-height:2.12em;color:#fff;background-color:var(--form-legend-backg-color);-ms-user-select:none;-webkit-user-select:none;user-select:none}.field-infor>.field-describe>i:empty,.form-group>legend:empty{display:none}.form-item{padding-block:var(--form-item-row-gap);padding-inline:1.2em;line-height:1em}.form-item:not(:first-of-type){border-top-width:1px;border-top-style:var(--form-item-border-style);border-color:#dcdcdc}.form-group:not(.nowrap) .field-infor{margin-top:.25em}.field-infor>.field-title{position:relative;font-weight:var(--form-field-title-weight)}.form-group:not(.nomark) .field-infor>.field-title.required::before{content:"*";position:absolute;margin-left:-.5em;vertical-align:top;font-weight:400;color:red}.field-infor>.field-describe{margin-top:.3em;margin-bottom:.45em;line-height:1.2em;font-size:.86em;color:#707070}.field-infor>.field-describe>i{font-style:normal}.form-group.nowrap .form-item-main.top{display:flex}.form-group.nowrap .form-item-main:not(.top){display:flex;align-items:center}.form-group.nowrap .form-item-main.top>.field-infor{padding-top:.65em}.form-group.nowrap .field-infor{flex:none;margin-right:.5em;width:var(--form-field-title-width)}.form-group.nowrap .field-infor>.field-title>span{display:inline-block;width:100%;text-align:justify;text-align-last:justify}.form-group.nowrap .field-infor>.field-describe{display:none;word-break:break-all}.field-input,.input-select{position:relative}.form-group.nowrap .field-input,.form-group.nowrap .field-select{flex:auto}.form-group:not(.nowrap) .field-input,.form-group:not(.nowrap) .field-select{width:var(--form-input-width)}input,select{font-family:inherit;white-space:nowrap}input,select,textarea{outline:0;font-size:inherit;background-color:#fff}input::placeholder,textarea::placeholder{color:#969696}select,textarea{border-width:1px;border-style:solid;border-color:#ccc}.field-input>label{display:block}.input-address,.input-checkbox,.input-radio{display:flex;flex-wrap:wrap;border-radius:var(--form-input-border-radius)}.input-checkbox>label,.input-radio>label{display:inline-flex;padding-block:.28em;padding-inline-end:.6em;max-width:100%;flex-grow:0;align-items:center;white-space:nowrap}.input-radio{padding-block:.45em;padding-inline:.44em}.form-group:not(.nowrap) .input-radio{margin-top:.4em}.input-radio>label{flex-basis:var(--form-input-radio-width)}.input-checkbox{padding:.28em .32em;min-height:2.28em;border:1px solid #ccc;background-color:#fff}.input-checkbox>label{flex-basis:var(--form-input-check-width)}.input-address>label{flex:1 1 33.33%;white-space:nowrap}.address-detail{margin-block-start:.2em}.input-select>.input-icon{position:absolute;width:100%;padding-inline:.45em;line-height:1.5em;text-align:right;font-size:1.6em;color:#464646}.select-option.open{visibility:visible}.select-option,.select-option>ol>li{border-radius:var(--form-input-border-radius)}.select-option{position:absolute;width:100%;z-index:2;margin-top:3px;padding:.45em .35em;visibility:hidden;font-size:.95em;background-color:#fff;box-shadow:0 1px 6px 1px #d4d4d4}.select-option>ol{display:flex;min-height:2.68em;max-height:23.6em;flex-wrap:wrap;gap:.2em;overflow-y:auto;background-color:#fff;scroll-behavior:smooth;scroll-snap-type:block;overscroll-behavior-y:contain}.select-option>ol>li{flex:1 1 100%;padding:.7em .6em;overflow-x:hidden;font-size:inherit;white-space:nowrap;scroll-snap-align:start;user-select:none}.select-option>ol>li:hover{background-color:#f0f1f4}.select-option>ol>li:active,.select-option>ol>li[selected]{color:#fff;background-color:var(--form-option-bgcolor)}.input-hidden{position:absolute;bottom:0;right:0;width:100%;z-index:-1}.field-input input:not([type=radio]):not([type=checkbox]):not([type=range]):not([type=color]):not([type=image]){width:100%;padding:.6em;border-width:1px;border-style:solid;border-radius:var(--form-input-border-radius)}input[type=email],input[type=file],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url]{border-color:#ccc}input[type=month],input[type=time],input[type^=date]{color:#969696;border-color:#ccc}.input-checkbox input[type=checkbox],.input-radio input[type=radio]{margin:0 .35em 0 .25em;width:.9em;height:.9em;accent-color:var(--form-input-accent-color)}.input-checkbox input[type=checkbox]{margin:0 .3em 0 .35em;width:.85em;height:.85em}.field-input textarea{width:100%;padding:.6em .3em .6em .6em;line-height:1.2em;border-radius:var(--form-input-border-radius);resize:none}.field-select select,.input-address select{width:100%;padding:.6em .6em .6em .38em;color:#969696;border-radius:var(--form-input-border-radius)}select>option{width:100%;font-size:1em;line-height:1.6em;white-space:nowrap;color:#000;background-color:#fff}option[hidden],select>option[value=""]{display:none;color:#969696}.invalid-msgbox{display:flex}.form-group:not(.nowrap) .invalid-msgbox{margin-bottom:.5em}.form-group.nowrap .invalid-msgbox::before{content:"";flex:none;margin-right:.72em;width:var(--form-field-title-width)}.form-validate{margin-block-end:1em;padding-inline:1.2em}.danger{flex:auto;margin-top:.25em;font-size:.88em;line-height:1.1em;color:red}.danger:empty{display:none}.form-button{display:flex;padding-block:.85em;padding-inline:1.2em;flex-wrap:wrap;align-items:center;align-content:center;justify-content:space-around;border-top-width:1px;border-top-style:solid;border-color:#dcdcdc}button{width:var(--form-input-width);appearance:none;outline:0;font-size:inherit;flex:none;flex-basis:var(--form-button-width);padding-inline:2em;margin-block:.35em;line-height:2.12em;white-space:nowrap;border:0;border-radius:var(--form-button-border-radius);cursor:pointer;-ms-user-select:none;-webkit-user-select:none;user-select:none}button[type=reset]{color:initial;background-color:#e5e5e5}button[type=button][value=back]{color:#fff;background-color:#e7696c}button[type=submit]{color:#fff;background-color:var(--form-button-backg-color)}@media (hover:hover) and (pointer:fine){button[type=reset]:hover{background-color:#d5d5d5}button[type=submit]:hover{background-color:var(--form-button-bgcolor-hover)}button[type=button][value=back]:hover{background-color:#d55255}}@media (hover:none) and (pointer:coarse){button[type=reset]:active{background-color:#bfbfbf}button[type=submit]:active{background-color:var(--form-button-bgcolor-active)}button[type=button][value=back]:active{background-color:#be5153}}.form-item:focus-within{background-color:var(--form-item-focus-bgcolor)}.form-item.invalid{background-color:var(--form-item-invalid-bgcolor)}input:not([readonly]):not([type=radio]):not([type=checkbox]):not([type=range]):not([type=image]):focus{border-color:var(--form-input-focus-color)}input.first:not([type=radio]):not([type=checkbox]):not([type=range]):not([type=image]):valid,input[required]:not([type=radio]):not([type=checkbox]):not([type=range]):not([type=image]):valid{border-color:var(--form-input-focus-color)}input.first[type=month]:valid,input.first[type=time]:valid,input.first[type^=date]:valid,input[type=month]:focus,input[type=month][required]:valid,input[type=time]:focus,input[type=time][required]:valid,input[type^=date]:focus,input[type^=date][required]:valid{color:inherit}input.invalid:not([type=radio]):not([type=checkbox]):not([type=range]):not([type=image]){color:red;border-color:#ff3c3c}input.first:not([type=radio]):not([type=checkbox]):not([type=range]):not([type=image]):invalid{color:red;border-color:#ff3c3c}input[data-type=select]:focus,select:focus,textarea:focus{border-color:var(--form-input-focus-color)}textarea.first:valid,textarea[required]:valid{border-color:var(--form-input-focus-color)}textarea.first:invalid,textarea.invalid{color:red;border-color:#ff3c3c}select.selected:valid,select[required]:valid{color:inherit;border-color:var(--form-input-focus-color)}.form-item.invalid .input-address select{border-color:#ff3c3c}select.invalid,select.selected:invalid{border-color:#ff3c3c}input.first[data-type=select]{border-color:var(--form-input-focus-color)}input[data-type=select]{user-select:none;cursor:default}input[readonly]:not([data-type=select]){color:#545454;background-color:#f0f0f0;cursor:default}input[disabled],select[disabled]{color:#545454;background-color:#f0f0f0;cursor:default}button,button:active,li,li:active,option,option:active{-webkit-tap-highlight-color:transparent}[contenteditable]:focus,button:focus{outline:0}'),this.#e.adoptedStyleSheets=[e],this.#e.append(this.#n)}get value(){const e=Object.create(null);for(const[t,n]of this.#s)e[n.name]=n.value;return e}get valid(){return this.#n.checkValidity()}get fields(){return this.#s}#c(){for(const[e,t]of this.#s)t.reset();this.scrollIntoView(!0)}#d(){for(const[e,t]of this.#s)if(!t.valid)return t.focus(),t.valid;return!0}#u(){this.#n.submit=()=>this.checkValidity(),this.#n.onreset=()=>{this.#c()},this.#i.back.onclick=()=>{history.back()},this.#i.submit.onclick=()=>{this.#d()}}#a(){this.#o.id="",this.#o.name="",this.#o.class="",this.#o.action="",this.#o.method="get",this.#o.target="_self",this.#o.enctype="application/x-www-form-urlencoded",this.#o.autocomplete="off",this.#o.nowrap=!1,this.#o.history=!1,this.#o.goback=!1,this.#o.button=Object.create(null),this.#o.button.back=!1,this.#o.button.reset=!0,this.#o.button.submit=!0;["text","search","number","password","tel","url","email","date","month","time","datetime","datetime-local"].forEach(e=>{this.register(e,TextControl)}),this.register("textarea",TextareaControl),this.register("select",SelectControl),this.register("radio",RadioControl),this.register("checkbox",CheckControl);this.#n=document.createRange().createContextualFragment('<form autocomplete="off"><div class="form-main"></div><div class="form-validate"><span class="danger"></span></div><div class="form-button"></div></form>').firstElementChild,this.#r.main=this.#n.querySelector(".form-main"),this.#r.danger=this.#n.querySelector(".danger"),this.#r.button=this.#n.querySelector(".form-button");const e=document.createElement("button");e.setAttribute("type","button"),e.setAttribute("value","back"),e.textContent="\u8fd4\u56de",this.#i.back=e;const t=document.createElement("button");t.setAttribute("type","reset"),t.setAttribute("value","reset"),t.textContent="\u91cd\u7f6e",this.#i.reset=t;const n=document.createElement("button");n.setAttribute("type","submit"),n.setAttribute("value","submit"),n.textContent="\u63d0\u4ea4",this.#i.submit=n,this.#u()}#h(){if(this.#t){for(const[e,t]of this.#s)t.unload();return this.#s.clear(),this.#r.main.textContent="",!0}return!1}hasControl(e){return!(!e||"string"!=typeof e)&&this.#l.has(e)}control(e){return e&&"string"==typeof e&&this.#l.has(e)?this.#l.get(e):null}field(e){return e&&"string"==typeof e&&this.#s.has(e)?this.#s.get(e):null}checkValidity(){const e=this.#n.checkValidity();return this.#d(),e}config(e){if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Form configuration must be of object type");const t=["id","name","class"],n=["action","method","autocomplete","enctype","target","charset"],o=t.concat(n);for(const t of o)if(Object.hasOwn(e,t)){if("string"!=typeof e[t])throw new Error(`The "config.${t}" attribute must be of string type.`);e[t].trim()&&(e[t]=e[t].trim(),this.#o[t]=e[t])}for(const n of t)Object.hasOwn(e,n)&&e[n].length>0&&this.setAttribute(n,e[n]);for(const t of n)Object.hasOwn(e,t)&&e[t].length>0&&this.#n.setAttribute(t,e[t]);const r=["nowrap","history"];for(const t of r)if(Object.hasOwn(e,t)){if("boolean"!=typeof e[t])throw new Error(`The "config.${t}" attribute must be of boolean type.`);e[t]?this.#o[t]=!0:this.#o[t]=!1}if(Object.hasOwn(e,"button")){if("[object Object]"!==Object.prototype.toString.call(e.button))throw new Error("Configuration button attribute requires object type");const t=["reset","back","submit"];for(const n of t)if(Object.hasOwn(e.button,n)){if("boolean"!=typeof e.button[n])throw new Error(`The "config.button.${n}" attribute must be of boolean type.`);e.button[n]?this.#o.button[n]=!0:this.#o.button[n]=!1}}return this.#o}register(e,t){e&&"string"==typeof e&&t&&this.#l.set(e,t)}render(e,t){if(FormControl.check(e)){this.#h();for(let t=0;t<e.length;t++){const n=e[t],o=document.createElement("fieldset");this.#o.nowrap&&o.classList.add("nowrap"),o.classList.add("form-group");const r=document.createElement("legend");if(n.group&&"string"==typeof n.group&&(r.textContent=n.group),o.append(r),n.fields&&Array.isArray(n.fields)){const e=n.fields;for(let t=0;t<e.length;t++){const n=e[t];if(!n.type||!this.hasControl(n.type))throw Error(`Control of type "${n.type}" is not registered.`);{const e=new(this.control(n.type))(n);this.#s.set(e.name,e),o.append(e.root)}}}this.#r.main.append(o)}const n=["back","reset","submit"];for(const e of n)this.#o.button[e]&&this.#r.button.append(this.#i[e]);const o=["id","name","class"];for(const e of o)this.#o[e]&&this.classList.add(this.#o[e]);return this.#t||(this.#t=t,this.#t.append(this)),!0}return!1}toggle(){const e=this.#r.main.querySelectorAll("fieldset");if(!e.length)return!1;for(let t=0;t<e.length;t++)this.#o.nowrap?(e[t].classList.remove("nowrap"),this.#o.nowrap=!1):(e[t].classList.add("nowrap"),this.#o.nowrap=!0);return!0}message(e){return this.#r.danger.textContent=e,e}clear(){return this.#r.danger.textContent&&(this.#r.danger.textContent=""),""}reset(){return this.#n.reset(),!0}submit(){return this.#n.requestSubmit(),this.#d()}unload(){return this.#h(),this.remove(),this.#t=null,this.#e.firstElementChild.remove(),this.#e=null,this.#r=null,this.#i=null,!0}async send(e={},t){try{if(!this.checkValidity())throw new Error("The form did not pass validation");if(!this.#o.action)throw new Error('Form "action" is required for submit');const n=this.#o.method.toUpperCase();try{if("GET"===n){const e=new URL(this.#o.action,window.location.href);Object.entries(this.value).forEach(([t,n])=>e.searchParams.append(t,n));const n=await fetch(e.toString());if(!n.ok)throw new Error(`Request failed with status ${n.status}`);const o=await n.text();return"function"==typeof t&&t(o),o}{const o=Object.create(null);if(o["Content-Type"]="application/json; charset=utf-8","object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e))for(const t of Object.keys(e))"string"!=typeof e[t]&&"number"!=typeof e[t]||(o[t]=e[t]);const r=await fetch(this.#o.action,{method:n,headers:o,body:JSON.stringify(this.value)});if(!r.ok)throw new Error(`Request failed with status ${r.status}`);const i=await r.json();return Object.hasOwn(i,"message")&&this.message(i.message),"function"==typeof t&&t(i),i}}catch(e){throw e}}catch(e){throw e}}static check(e){if(void 0===e||null==e)throw new Error("Required parameter missing");if("[object Array]"!==Object.prototype.toString.call(e))throw new Error("Parameter type error");if(0==e.length)throw new Error("Configuration information cannot be empty");if(e.length>0)for(const t of e){if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("Grouping configuration requires object type");if(Object.hasOwn(t,"group")&&"string"!=typeof t.group)throw new Error('The "group" attribute must be of string type.');if(!Object.hasOwn(t,"fields"))throw new Error('The "fields" attribute is a required attribute.');if("[object Array]"!==Object.prototype.toString.call(t.fields))throw new Error('The "fields" attribute must be of array type')}return!0}disconnectedCallback(){this.unload()}}customElements.define("ele-form",FormControl);
